<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bodybuilding Training System</title>

<style>
  /* ---------- Theme Variables ---------- */
  :root{
    --bg: #0d0d0d;
    --card: #131313;
    --muted: #bdbdbd;
    --text: #fff;
    --accent: #ff2a2a;
    --accent-2: #ff6b6b;
    --border: rgba(255,255,255,0.06);
    --radius: 12px;
    --gap: 18px;
    --header-height: 72px; /* Define header height as a variable */
  }
  .light{
    --bg:#f7f7f7; --card:#fff; --muted:#333; --text:#111; --accent:#e60000; --border:rgba(0,0,0,0.08);
  }

  /* ---------- Base ---------- */
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Poppins',sans-serif;-webkit-font-smoothing:antialiased}
  a{color:inherit}
  /* Adjusted container margin/padding to account for fixed header */
  .container{
    width:94%;
    max-width:1200px;
    /* Use padding-top to create space for fixed header */
    padding: calc(var(--header-height) + var(--gap)) var(--gap) 60px;
    margin: 0 auto;
  }
  /* Ensure padding inside container is consistent */
  .container > div {
    padding: 0;
  }
  @media (max-width: 600px) {
    /* Slightly less vertical padding on small screens */
    .container {
        padding: calc(var(--header-height) + 12px) 12px 30px;
        width: 100%;
    }
  }


/* ---------- Header ---------- */
  header{
    position:fixed;left:0;right:0;top:0;height:var(--header-height);
    background:rgba(19, 19, 19, 0.9); /* More solid background for better readability */
    background:var(--card); /* Simplified background for better theme integration */
    display:flex;align-items:center;gap:16px;padding:12px 20px;border-bottom:1px solid var(--border);
    backdrop-filter: blur(6px);
    z-index:1200; /* High z-index to prevent any overlap */
  }
  .light header{ background:rgba(255, 255, 255, 0.95); } /* Light theme background with transparency */
  header h1{margin:0;font-size:18px;letter-spacing:0.2px}
  .header-controls{margin-left:auto;display:flex;gap:10px;align-items:center}
  .plan-selector,.toggle-btn{appearance:none;border-radius:10px;padding:9px 12px;border:1px solid var(--border);background:var(--card);color:var(--text);cursor:pointer; font-size:14px; }
  .toggle-btn{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;border:none;font-weight:700}
  @media (max-width: 500px) {
    header h1 { font-size: 16px; }
    .plan-selector, .toggle-btn { padding: 8px 10px; font-size: 13px; }
  }


/* ---------- Layout ---------- */
  .layout{display:grid;grid-template-columns:320px 1fr;gap:var(--gap)}
  @media (max-width:980px){
    /* Single column layout for tablets and phones */
    .layout{grid-template-columns:1fr;padding-top:0}
  }

  /* Sidebar styling adjustments */
  .sidebar{
    background:var(--card);padding:16px;border-radius:var(--radius);border:1px solid var(--border);
    min-height:220px;display:flex;flex-direction:column;gap:12px;
    /* Desktop: sticky position */
    position:sticky;
    top: calc(var(--header-height) + var(--gap) - 4px); /* Stick below the header */
  }
  @media (max-width:980px){
    /* Mobile/Tablet: remove sticky, allow flow */
    .sidebar{
        position: static;
    }
  }

  .panel{background:var(--card);padding:18px;border-radius:var(--radius);border:1px solid var(--border)}

/* ---------- Days Row ---------- */
  .days{display:flex;flex-wrap:wrap;gap:8px}
  .day{
    /* Use min/max to ensure it flexes but doesn't get too small or large */
    flex:1 1 auto;
    min-width: calc(100% / 4 - 6px); /* 4 per row on desktop/large tablet */
    max-width: 120px;
    background:transparent;border:1px solid var(--border);padding:10px;border-radius:10px;text-align:center;cursor:pointer;transition:all .18s;
    display: flex; /* Added flex for better content control */
    flex-direction: column; /* Stack day name and date */
    line-height: 1.2;
    font-size: 14px;
  }
  /* Added style for the date/small text inside the day button */
  .day .date-info {
    font-size: 11px;
    color: var(--muted);
    font-weight: 400;
    margin-top: 2px;
  }
  .day.active .date-info {
      color: rgba(255, 255, 255, 0.7);
  }

  @media (max-width: 500px) {
    /* 3 per row on small phones */
    .day {
      min-width: calc(100% / 3 - 6px);
      max-width: unset;
    }
  }
  .day:hover{transform:translateY(-3px)}
  .day.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;border-color:transparent;box-shadow:0 6px 20px rgba(0,0,0,0.6)}

/* ---------- Exercises panel ---------- */
  .exercise-box{display:flex;flex-direction:column;gap:12px}
  /* Optimized grid for exercise rows */
  .exercise-row{display:grid;grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));gap:12px}
  /* Original media query is a bit low, using the new auto-fit is better, but keep for fallback */
  @media (max-width:680px){.exercise-row{grid-template-columns:1fr}}

  .exercise-card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    padding:14px;border-radius:10px;border:1px solid var(--border);
    /* Reduced shadow for lighter look */
    box-shadow:0 4px 15px rgba(0,0,0,0.3);
    animation:floatIn .28s ease both;
  }
  .exercise-card h3{margin:0 0 8px 0;font-size:16px}
  .exercise-card p{margin:0;color:var(--muted);font-size:14px;line-height:1.6}

/* ---------- Custom Builder ---------- */
  .builder .input, input, select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--bg);color:var(--text);margin-top:10px}
  .add-btn{width:100%;padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;font-weight:700;cursor:pointer;margin-top:10px; transition: background-color 0.2s;}
  /* Ensure the custom list controls don't break layout */
  .custom-list{display:flex;flex-direction:column;gap:8px;margin-top:12px}
  .custom-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;border:1px solid var(--border);flex-wrap: wrap; gap: 8px;}
  .custom-item > div:first-child { flex: 1 1 50%; min-width: 150px; } /* Ensure text has space */
  .custom-item > div:last-child { display: flex; gap: 8px; }

  /* Adjust buttons inside custom-item */
  .custom-item .add-btn {
      width: auto;
      padding: 8px 10px !important;
      margin-top: 0 !important;
      font-size: 13px;
  }
  .custom-item .add-btn:first-of-type { /* Edit button style */
      background: var(--muted);
      color: var(--text);
  }
  .custom-item .add-btn:last-of-type { /* Delete button style */
      background: #8e1818; /* Darker red */
  }

/* ---------- Helpers ---------- */
  .muted{color:var(--muted)} .mb-8{margin-bottom:8px}
  @keyframes floatIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
  .footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}

/* ---------- Accessibility focus ---------- */
  .day:focus, .plan-selector:focus, .toggle-btn:focus, .add-btn:focus, .input:focus, .custom-item .add-btn:focus{outline:3px solid rgba(255,42,42,0.3);outline-offset:3px}
</style>
</head>
<body>

<header>
  <h1>Bodybuilding Training System</h1>
  <div class="header-controls">
    <label for="plan-select" class="small muted" style="display:none">Choose plan</label>
    <select id="plan-select" class="plan-selector" aria-label="Choose training plan"></select>
    <button id="theme-toggle" class="toggle-btn" onclick="toggleTheme()" aria-pressed="false">ðŸŒ— Mode</button>
  </div>
</header>

<main class="container">
  <div class="layout">

    <aside class="sidebar" aria-label="Week Planner">
      <div>
        <h2 style="margin:0 0 8px 0">Week Planner</h2>
        <p class="small muted mb-8">Tap a day to view exercises. Edit or add custom exercises below.</p>
      </div>

      <div class="days" id="day-tabs" role="tablist" aria-label="Days of week">
        <button class="day" data-day="1" role="tab">Day 1</button>
        <button class="day" data-day="2" role="tab">Day 2</button>
        <button class="day" data-day="3" role="tab">Day 3</button>
        <button class="day" data-day="4" role="tab">Day 4</button>
        <button class="day" data-day="5" role="tab">Day 5</button>
        <button class="day" data-day="6" role="tab">Day 6</button>
        <button class="day" data-day="7" role="tab">Day 7</button>
      </div>

      <div class="builder" aria-label="Custom builder">
        <h3 style="margin:8px 0 0 0">Custom Workout Builder</h3>
        <small class="small muted">Add an exercise for selected day.</small>

        <select id="custom-day" class="input" aria-label="Choose day for custom exercise"></select>
        <input id="custom-exercise" class="input" placeholder="Enter Exercise (e.g. Cable Fly â€” 4Ã—12)" aria-label="Exercise description" />
        <button class="add-btn" onclick="addCustomExercise()">Add Exercise</button>

        <div id="custom-list" class="custom-list" aria-live="polite"></div>
      </div>
    </aside>

    <section class="panel">
      <div id="exercise-container" class="exercise-box" aria-live="polite">
        <h2 style="margin:0 0 8px 0">Select a day</h2>
        <p class="muted small">Choose a day from the left to view the workout. Use the plan selector at top to change programs.</p>
      </div>

    </section>

  </div>
</main>

<script>
/* ---------------- DEFAULT PLANS (Option B â€” Medium selections) ---------------- */
const defaultPlans = {
  "Chest Priority": {
    1:{title:"Chest â€” Heavy & Volume", exercises:[
      "Barbell Bench Press â€” 5Ã—5",
      "Incline Dumbbell Press â€” 4Ã—8â€“10",
      "Flat Dumbbell Press â€” 4Ã—10",
      "Cable Fly (Low to High) â€” 4Ã—12",
      "Chest Dips (weighted if possible) â€” 3Ã—AMRAP",
      "Dumbbell Pullover â€” 3Ã—12"
    ]},
    2:{title:"Back â€” Width & Thickness", exercises:[
      "Deadlift â€” 4Ã—4â€“6",
      "Weighted Pull-ups â€” 4Ã—6â€“10",
      "Bent-Over Barbell Row â€” 4Ã—6â€“8",
      "Seated Cable Row â€” 4Ã—10",
      "Lat Pulldown (wide grip) â€” 3Ã—10â€“12"
    ]},
    3:{title:"Shoulders & Traps", exercises:[
      "Overhead Barbell Press â€” 4Ã—6â€“8",
      "Dumbbell Lateral Raise â€” 4Ã—12â€“15",
      "Rear Delt Fly / Face Pulls â€” 4Ã—12",
      "Barbell Shrugs â€” 4Ã—10",
      "Arnold Press â€” 3Ã—10"
    ]},
    4:{title:"Legs â€” Quad Focus", exercises:[
      "Back Squat â€” 5Ã—5",
      "Leg Press â€” 4Ã—10",
      "Walking Lunges â€” 3Ã—12 each leg",
      "Leg Extension â€” 4Ã—12",
      "Standing Calf Raises â€” 4Ã—15â€“20"
    ]},
    5:{title:"Chest â€” Pump & Volume", exercises:[
      "Incline Bench â€” 4Ã—8â€“10",
      "Decline Dumbbell Press â€” 4Ã—10",
      "Cable Crossover â€” 4Ã—15",
      "Pec Deck / Machine Fly â€” 3Ã—12",
      "Push-Ups (slow tempo) â€” 3Ã—AMRAP"
    ]},
    6:{title:"Arms â€” Biceps & Triceps", exercises:[
      "Barbell Curl â€” 4Ã—8â€“10",
      "Hammer Curl â€” 4Ã—10â€“12",
      "Preacher Curl â€” 3Ã—10",
      "Skull Crushers â€” 4Ã—8â€“10",
      "Triceps Rope Pushdown â€” 4Ã—12",
      "Reverse Wrist Curl â€” 3Ã—15"
    ]},
    7:{title:"Rest & Mobility", exercises:[
      "Light Stretching â€” 15â€“20 min",
      "Foam Rolling â€” 10 min",
      "Optional Light Walk â€” 20â€“30 min"
    ]}
  },

  "Gymrat PPL": {
    1:{title:"Push â€” Chest/Shoulders/Triceps", exercises:[
      "Barbell Bench Press â€” 5Ã—5",
      "Overhead Press â€” 4Ã—6â€“8",
      "Incline Dumbbell Press â€” 4Ã—8â€“10",
      "Lateral Raises â€” 4Ã—12",
      "Triceps Dips â€” 3Ã—AMRAP"
    ]},
    2:{title:"Pull â€” Back/Biceps", exercises:[
      "Deadlift â€” 4Ã—4â€“6",
      "Pull Ups â€” 4Ã—6â€“10",
      "One-Arm Dumbbell Row â€” 4Ã—8â€“10",
      "Face Pulls â€” 4Ã—12",
      "EZ Bar Curl â€” 3Ã—10"
    ]},
    3:{title:"Legs â€” Full", exercises:[
      "Squat â€” 5Ã—5",
      "Romanian Deadlift â€” 4Ã—8",
      "Leg Press â€” 4Ã—10",
      "Hamstring Curl â€” 4Ã—12",
      "Seated Calf Raise â€” 4Ã—15"
    ]},
    4:{title:"Push â€” Volume", exercises:[
      "Incline Bench â€” 4Ã—10",
      "Dumbbell Shoulder Press â€” 4Ã—10",
      "Chest Fly â€” 4Ã—12",
      "Triceps Pushdown â€” 4Ã—12"
    ]},
    5:{title:"Pull â€” Volume", exercises:[
      "Lat Pulldown â€” 4Ã—12",
      "Cable Row â€” 4Ã—12",
      "Hammer Curl â€” 4Ã—12",
      "Rear Delt Raises â€” 3Ã—15"
    ]},
    6:{title:"Legs â€” Hypertrophy", exercises:[
      "Front Squat â€” 4Ã—8",
      "Bulgarian Split Squat â€” 3Ã—10",
      "Glute Bridge â€” 4Ã—12",
      "Calf Raise â€” 4Ã—20"
    ]},
    7:{title:"Rest", exercises:[
      "Mobility Work â€” 15 min",
      "Optional Swim/Walk â€” 20â€“30 min"
    ]}
  },

  "Fat-Loss Hybrid": {
    1:{title:"Chest + HIIT", exercises:[
      "Incline DB Press â€” 4Ã—12",
      "Push-ups â€” 3Ã—15â€“20",
      "Cable Fly â€” 3Ã—15",
      "HIIT Sprints â€” 12â€“15 min"
    ]},
    2:{title:"Back + Core", exercises:[
      "Pull Ups â€” 4Ã—8â€“10",
      "Seated Row â€” 4Ã—12",
      "Plank â€” 3Ã—60s",
      "Mountain Climbers â€” 3Ã—30s"
    ]},
    3:{title:"Legs + Cardio", exercises:[
      "Squat â€” 4Ã—10",
      "Walking Lunges â€” 3Ã—12",
      "Kettlebell Swing â€” 4Ã—12",
      "Bike â€” 20 min steady"
    ]},
    4:{title:"Shoulders & Arms", exercises:[
      "Overhead Press â€” 4Ã—8",
      "Side Lateral â€” 4Ã—12",
      "Bicep Curl â€” 4Ã—10",
      "Triceps Rope â€” 4Ã—12"
    ]},
    5:{title:"Full Body Metcon", exercises:[
      "Thrusters â€” 4Ã—10",
      "Burpees â€” 3Ã—15",
      "Row â€” 500m x3 (rest between sets)",
      "Core Circuit â€” 10 min"
    ]},
    6:{title:"Active Recovery", exercises:[
      "Yoga Flow â€” 20 min",
      "Light Cardio â€” 20 min"
    ]},
    7:{title:"Rest", exercises:[
      "Stretching â€” 15 min"
    ]}
  },

  "Aesthetic Split": {
    1:{title:"Chest & Shoulders", exercises:[
      "Flat Bench â€” 4Ã—8",
      "Incline Fly â€” 4Ã—12",
      "Lateral Raise â€” 4Ã—15",
      "Cable Fly â€” 3Ã—15"
    ]},
    2:{title:"Back & Arms", exercises:[
      "Deadlift â€” 4Ã—6",
      "Pull Ups â€” 4Ã—8",
      "Barbell Row â€” 4Ã—8",
      "EZ Bar Curl â€” 4Ã—10"
    ]},
    3:{title:"Legs", exercises:[
      "Squat â€” 4Ã—8",
      "Leg Press â€” 4Ã—10",
      "Hamstring Curl â€” 4Ã—12",
      "Standing Calf â€” 4Ã—15"
    ]},
    4:{title:"Chest Pump", exercises:[
      "Incline DB Press â€” 4Ã—10",
      "Cable Crossover â€” 4Ã—15",
      "Push-Ups â€” 3Ã—AMRAP"
    ]},
    5:{title:"Shoulders & Arms", exercises:[
      "OHP â€” 4Ã—8",
      "Hammer Curl â€” 4Ã—12",
      "Skull Crushers â€” 4Ã—10"
    ]},
    6:{title:"Full Body Pump", exercises:[
      "Bench â€” 3Ã—10",
      "Row â€” 3Ã—12",
      "Squat â€” 3Ã—12",
      "Core Work â€” 8â€“10 min"
    ]},
    7:{title:"Rest", exercises:[
      "Mobility â€” 15 min"
    ]}
  }
};

/* ---------------- DATE AND DAY UTILITIES (NEW) ---------------- */
const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

// Get the date information for the next 7 days starting today
function getWeekInfo() {
  const week = [];
  const today = new Date();
  
  for (let i = 0; i < 7; i++) {
    const day = new Date(today);
    day.setDate(today.getDate() + i);
    
    // Day number (1-7) corresponding to the workout data structure
    const dayNumber = (i + 1);
    
    // Day name (Mon, Tue, etc.)
    const dayName = i === 0 ? 'Today' : dayNames[day.getDay()];
    
    // Date in DD/MM format
    const date = day.getDate();
    
    week.push({ dayNumber, dayName, date });
  }
  return week;
}

const weekInfo = getWeekInfo();
let currentDayIndex = 1; // Default to Day 1 on load

/* ---------------- LOAD / INIT ---------------- */
let currentPlanName = localStorage.getItem("planName") || "Chest Priority";
let workouts = JSON.parse(localStorage.getItem("workouts")) || JSON.parse(JSON.stringify(defaultPlans[currentPlanName]));

/* ---------- Populate plan select ---------- */
const planSelect = document.getElementById('plan-select');
Object.keys(defaultPlans).forEach(name=>{
  const opt = document.createElement('option');
  opt.value = name; opt.textContent = name;
  planSelect.appendChild(opt);
});
planSelect.value = currentPlanName;
planSelect.addEventListener('change', () => {
  currentPlanName = planSelect.value;
  // Deep clone default plan to 'workouts' when a new one is selected
  workouts = JSON.parse(JSON.stringify(defaultPlans[currentPlanName])); 
  saveWorkouts();
  // Select day 1 after changing plan
  showExercises(1); 
});

/* ---------- Populate custom day select ---------- */
const customDaySelect = document.getElementById('custom-day');
customDaySelect.innerHTML = ''; // Clear existing options
weekInfo.forEach(info => {
    const o = document.createElement('option'); 
    o.value = info.dayNumber; 
    o.textContent = `${info.dayName} (${info.date})`; 
    customDaySelect.appendChild(o); 
});

/* ---------- Day buttons (UPDATED) ---------- */
const dayTabs = document.getElementById('day-tabs');
dayTabs.innerHTML = ''; // Clear default HTML buttons

weekInfo.forEach(info => {
    const btn = document.createElement('button');
    btn.className = 'day';
    btn.dataset.day = info.dayNumber;
    btn.role = 'tab';
    btn.innerHTML = `<strong>${info.dayName}</strong><span class="date-info">${info.date}</span>`;
    dayTabs.appendChild(btn);
});

dayTabs.addEventListener('click', (e)=>{
  const btn = e.target.closest('.day');
  if(btn){
    const d = btn.dataset.day;
    document.getElementById('custom-day').value = d;
    showExercises(d);
  }
});

/* ---------- Show exercises ---------- */
function showExercises(day){
  currentDayIndex = day; // Update the global tracker
  // active style
  document.querySelectorAll('.day').forEach(x=>x.classList.remove('active'));
  const clicked = document.querySelector(`.day[data-day="${day}"]`);
  if(clicked){ 
    clicked.classList.add('active'); 
    clicked.focus(); // Set focus for accessibility
  }

  const data = workouts[day];
  const box = document.getElementById('exercise-container');
  if(!data){ box.innerHTML = '<h2>Day not found</h2>'; return; }

  // Build layout: heading + exercise cards
  let html = `<h2 style="margin:0 0 10px 0">${data.title}</h2>`;
  html += `<div class="exercise-row">`;

  // Filter out custom exercises which will be loaded in the sidebar list
  const defaultEx = data.exercises.filter(ex => {
      // Check if the exercise is present in the original default plan
      const currentPlanDefault = defaultPlans[currentPlanName][day];
      return currentPlanDefault && currentPlanDefault.exercises.includes(ex);
  });
  
  // Decide which list to use for the main cards - custom ones will be shown below
  const primaryList = defaultEx.length > 0 ? defaultEx : data.exercises;
  
  // split exercises into two columns evenly
  const perCol = Math.ceil(primaryList.length / 2);
  const col1 = primaryList.slice(0, perCol);
  const col2 = primaryList.slice(perCol);

  html += `<div class="exercise-card"><h3>Primary Focus</h3><p>${col1.map(e=>'â€¢ '+escapeHtml(e)).join('<br>')}</p></div>`;
  // If no secondary/accessory exercises, use a sensible default text
  const secondaryContent = col2.length ? 
      col2.map(e=>'â€¢ '+escapeHtml(e)).join('<br>') : 
      (col1.length > 0 ? 'â€¢ Accessory work / Finisher' : 'â€¢ Rest / Mobility');
      
  html += `<div class="exercise-card"><h3>Secondary / Accessories</h3><p>${secondaryContent}</p></div>`;

  html += `</div>`; // exercise-row

  box.innerHTML = html;
  loadCustomList(day);
}

/* ---------- Custom builder functions ---------- */
function loadCustomList(day){
  const list = document.getElementById('custom-list');
  list.innerHTML = '';
  
  // Find all exercises that are NOT in the default plan for this day
  const defaultExercises = defaultPlans[currentPlanName][day].exercises;
  const customExercises = (workouts[day].exercises || []).filter(ex => !defaultExercises.includes(ex));
  
  if (customExercises.length === 0) {
      list.innerHTML = `<p class="small muted" style="margin-top:10px">No custom exercises for this day.</p>`;
      return;
  }
  
  // Re-index based on the filtered custom list
  customExercises.forEach((ex,i)=>{
    // Find the original index in the main 'workouts' array to allow for correct deletion/editing
    const originalIndex = workouts[day].exercises.indexOf(ex); 
      
    const wrapper = document.createElement('div'); wrapper.className='custom-item';
    const left = document.createElement('div');
    left.innerHTML = `<strong style="display:block">${ex}</strong><span class="small muted">${weekInfo[day-1].dayName} (${weekInfo[day-1].date}) â€¢ Custom #${i+1}</span>`;
    const actions = document.createElement('div');
    const editBtn = document.createElement('button'); 
    editBtn.textContent='Edit'; 
    editBtn.className='add-btn'; 
    editBtn.onclick = ()=> editExercise(day,originalIndex);
    
    const delBtn = document.createElement('button'); 
    delBtn.textContent='Delete'; 
    delBtn.className='add-btn'; 
    delBtn.onclick = ()=> deleteExercise(day,originalIndex);
    
    actions.appendChild(editBtn); actions.appendChild(delBtn);
    wrapper.appendChild(left); wrapper.appendChild(actions);
    list.appendChild(wrapper);
  });
  document.getElementById('custom-day').value = day;
}

function addCustomExercise(){
  const day = document.getElementById('custom-day').value;
  const ex = document.getElementById('custom-exercise').value.trim();
  if(!ex){ alert('Enter a valid exercise'); return; }
  
  // Add new custom exercise to the end of the day's exercise list
  workouts[day].exercises.push(ex);
  saveWorkouts();
  document.getElementById('custom-exercise').value = '';
  showExercises(day);
}

function editExercise(day,index){
  const current = workouts[day].exercises[index];
  const v = prompt('Edit exercise:', current);
  if(v && v.trim()!==''){ 
      workouts[day].exercises[index] = v.trim(); 
      saveWorkouts(); 
      showExercises(day); 
  }
}
function deleteExercise(day,index){
  // Find out if this is a default exercise or a custom one
  const isDefault = defaultPlans[currentPlanName][day].exercises.includes(workouts[day].exercises[index]);
  
  let msg = 'Remove this exercise?';
  if(isDefault) {
      msg = 'This is a default exercise. Do you want to remove it from this day? (You can re-add it by switching plans and back.)';
  }
  
  if(confirm(msg)){ 
      workouts[day].exercises.splice(index,1); 
      saveWorkouts(); 
      showExercises(day); 
  }
}

/* ---------- Save / storage ---------- */
function saveWorkouts(){ localStorage.setItem('workouts', JSON.stringify(workouts)); localStorage.setItem('planName', currentPlanName); }

/* ---------- Auto-select today (UPDATED) ---------- */
// Today corresponds to day 1 in the weekInfo array
showExercises(1);

/* ---------- Theme ---------- */
const themeToggle = document.getElementById('theme-toggle');
if(localStorage.getItem('theme')==='light'){
    document.body.classList.add('light');
    themeToggle.setAttribute('aria-pressed', 'true');
} else {
    themeToggle.setAttribute('aria-pressed', 'false');
}

function toggleTheme(){
  document.body.classList.toggle('light');
  const isLight = document.body.classList.contains('light');
  themeToggle.setAttribute('aria-pressed', isLight? 'true' : 'false');
  localStorage.setItem('theme', isLight? 'light':'dark');
}

/* ---------- Utility ---------- */
function escapeHtml(text){
  return String(text).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
}
</script>

</body>
</html>
